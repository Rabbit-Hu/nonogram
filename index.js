multiColorImages = {
    duck: [
        ['ddfdff','fdeb83','fdeb83','fdeb83','ddfdff'],
        ['ddfdff','fdeb83','535353','fdeb83','ddfdff'],
        ['ffbe55','fdeb83','fdeb83','fdeb83','ddfdff'],
        ['ddfdff','fdeb83','fdeb83','fdeb83','fdeb83'],
        ['ddfdff','fdeb83','fdeb83','f1dd69','f1dd69'],
    ],
    erxiaomen: [
        ["ffffff","ffffff","8eccf3","8eccf3","8eccf3","8eccf3","8eccf3","8eccf3","8eccf3","ffffff","ffffff","8eccf3","8eccf3","ffffff","8eccf3",],
        ["ffffff","ffffff","8eccf3","ffffff","ffffff","8eccf3","8eccf3","c3c3c3","ffffff","ffffff","ffffff","ffffff","ffffff","ffffff","ffffff",],
        ["8eccf3","7ab175","ffffff","ffffff","7ab175","ffffff","8eccf3","c3c3c3","8eccf3","8eccf3","7ab175","ffffff","ffffff","7ab175","ffffff",],
        ["8eccf3","7ab175","8eccf3","8eccf3","7ab175","8eccf3","8eccf3","c3c3c3","8eccf3","8eccf3","7ab175","8eccf3","8eccf3","7ab175","8eccf3",],
        ["7ab175","7ab175","7ab175","e7e7e7","e7e7e7","e7e7e7","e7e7e7","e7e7e7","e7e7e7","e7e7e7","e7e7e7","e7e7e7","7ab175","7ab175","7ab175",],
        ["7ab175","7ab175","848484","848484","848484","c3c3c3","c3c3c3","c3c3c3","c3c3c3","c3c3c3","848484","848484","848484","7ab175","7ab175",],
        ["7ab175","7ab175","7ab175","848484","848484","666666","e7e7e7","666666","e7e7e7","666666","848484","848484","7ab175","7ab175","7ab175",],
        ["7ab175","7ab175","7ab175","848484","cfdbe8","c3c3c3","c3c3c3","c3c3c3","c3c3c3","c3c3c3","cfdbe8","848484","7ab175","7ab175","7ab175",],
        ["7ab175","7ab175","7ab175","848484","cfdbe8","e7e7e7","e7e7e7","e7e7e7","e7e7e7","e7e7e7","cfdbe8","848484","7ab175","7ab175","7ab175",],
        ["7ab175","c3c3c3","c3c3c3","848484","cfdbe8","e7e7e7","7ab175","7ab175","7ab175","e7e7e7","cfdbe8","848484","c3c3c3","c3c3c3","7ab175",],
        ["c3c3c3","e7e7e7","e7e7e7","848484","cfdbe8","7ab175","7ab175","7ab175","7ab175","7ab175","cfdbe8","848484","e7e7e7","e7e7e7","c3c3c3",],
        ["848484","e7e7e7","e7e7e7","848484","cfdbe8","7ab175","7ab175","7ab175","7ab175","7ab175","cfdbe8","848484","e7e7e7","e7e7e7","848484",],
        ["848484","7ab175","7ab175","848484","cfdbe8","7ab175","7ab175","7ab175","7ab175","7ab175","cfdbe8","848484","7ab175","7ab175","848484",],
        ["848484","7ab175","7ab175","848484","848484","7ab175","7ab175","7ab175","7ab175","7ab175","848484","848484","7ab175","7ab175","848484",],
        ["cfdbe8","668772","668772","848484","848484","668772","668772","668772","668772","668772","848484","848484","668772","668772","cfdbe8",]
    ],
    dalitang: [
        ["ffffff","96e2ff","96e2ff","96e2ff","4e6572","4e6572","4e6572","4e6572","4e6572","4e6572","4e6572","96e2ff","96e2ff","ffffff","96e2ff",],
        ["ffffff","ffffff","96e2ff","4e6572","4e6572","4e6572","4e6572","4e6572","4e6572","4e6572","4e6572","4e6572","ffffff","ffffff","ffffff",],
        ["96e2ff","96e2ff","96e2ff","c17a49","cd8355","cd8355","c17a49","fbe5bc","c17a49","cd8355","c17a49","cd8355","96e2ff","96e2ff","96e2ff",],
        ["fbe5bc","c98a73","cf9173","cd8355","cd8355","fbe5bc","fbe5bc","c17a49","fbe5bc","fbe5bc","c17a49","c17a49","cf9173","c98a73","fbe5bc",],
        ["fbe5bc","cf9173","c98a73","fbe5bc","fbe5bc","c17a49","cd8355","cd8355","cd8355","c17a49","fbe5bc","fbe5bc","c98a73","cf9173","fbe5bc",],
        ["d8bc99","d8bc99","fbe5bc","c17a49","cd8355","c17a49","cd8355","c17a49","c17a49","cd8355","cd8355","c17a49","fbe5bc","d8bc99","d8bc99",],
        ["fbe5bc","fbe5bc","d8bc99","d8bc99","fbe5bc","fbe5bc","fbe5bc","fbe5bc","fbe5bc","fbe5bc","fbe5bc","d8bc99","d8bc99","fbe5bc","fbe5bc",],
        ["c98a73","c98a73","cd8355","cd8355","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","cd8355","c17a49","cf9173","c98a73",],
        ["cf9173","c98a73","d8bc99","d8bc99","fbe5bc","4e6572","fbe5bc","4e6572","fbe5bc","4e6572","fbe5bc","d8bc99","d8bc99","c98a73","cf9173",],
        ["cf9173","c98a73","cd8355","c17a49","fbe5bc","d8bc99","fbe5bc","d8bc99","fbe5bc","d8bc99","fbe5bc","cd8355","cd8355","c98a73","c98a73",],
        ["c98a73","c98a73","c17a49","cd8355","fbe5bc","4e6572","fbe5bc","4e6572","fbe5bc","4e6572","fbe5bc","cd8355","c17a49","cf9173","c98a73",],
        ["c98a73","cf9173","c17a49","c17a49","fbe5bc","4e6572","fbe5bc","4e6572","fbe5bc","4e6572","fbe5bc","c17a49","c17a49","c98a73","cf9173",],
        ["c98a73","c98a73","c17a49","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","d8bc99","cd8355","c98a73","c98a73",],
        ["7dd69c","7dd69c","b6957c","b6957c","b6957c","b6957c","b6957c","b6957c","b6957c","b6957c","b6957c","b6957c","b6957c","5fcc86","7dd69c",],
        ["5fcc86","7dd69c","5fcc86","7dd69c","5fcc86","5fcc86","5fcc86","7dd69c","5fcc86","5fcc86","7dd69c","5fcc86","7dd69c","7dd69c","5fcc86",]
    ],
    xuetang: [
        ["96e2ff","96e2ff","96e2ff","96e2ff","96e2ff","c35a56","c35a56","9c5955","c35a56","c35a56","96e2ff","96e2ff","96e2ff","96e2ff","96e2ff",],
        ["559685","6aa18f","fff2e9","fff2e9","c35a56","c35a56","9c5955","9c5955","9c5955","c35a56","c35a56","fff2e9","fff2e9","96e2ff","96e2ff",],
        ["6aa18f","559685","559685","fff2e9","fff2e9","fff2e9","fff2e9","fff2e9","fff2e9","fff2e9","fff2e9","fff2e9","fff2e9","96e2ff","96e2ff",],
        ["559685","9c5955","559685","d9c6ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","96e2ff","96e2ff","96e2ff",],
        ["9c5955","559685","559685","96a7ba","5e6076","fff2e9","5e6076","fff2e9","5e6076","fff2e9","5e6076","96a7ba","fff2e9","6aa18f","559685",],
        ["559685","6aa18f","fff2e9","8290a5","8290a5","d9c6ba","fff2e9","828283","fff2e9","d9c6ba","8290a5","8290a5","559685","559685","6aa18f",],
        ["6aa18f","d9c6ba","fff2e9","96a7ba","96a7ba","d9c6ba","fff2e9","5e6076","fff2e9","d9c6ba","96a7ba","96a7ba","6aa18f","9c5955","559685",],
        ["96a7ba","d9c6ba","fff2e9","8290a5","8290a5","fff2e9","fff2e9","fff2e9","fff2e9","fff2e9","8290a5","8290a5","559685","559685","9c5955",],
        ["96a7ba","d9c6ba","fff2e9","96a7ba","96a7ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","96a7ba","96a7ba","fff2e9","6aa18f","9c5955",],
        ["96a7ba","d9c6ba","fff2e9","8290a5","8290a5","d9c6ba","d9c6ba","d9c6ba","d9c6ba","d9c6ba","8290a5","8290a5","fff2e9","559685","9c5955",],
        ["96a7ba","d9c6ba","fff2e9","96a7ba","96a7ba","5e6076","fff2e9","9c5955","fff2e9","5e6076","96a7ba","96a7ba","fff2e9","d9c6ba","9c5955",],
        ["96a7ba","d9c6ba","fff2e9","8290a5","8290a5","fff2e9","9c5955","9c5955","9c5955","fff2e9","8290a5","8290a5","fff2e9","d9c6ba","9c5955",],
        ["8290a5","d9c6ba","fff2e9","96a7ba","96a7ba","5e6076","603a30","603a30","603a30","5e6076","96a7ba","96a7ba","fff2e9","d9c6ba","9c5955",],
        ["dae6de","8290a5","fff2e9","8290a5","8290a5","5e6076","9c5955","603a30","9c5955","5e6076","8290a5","8290a5","fff2e9","8290a5","9c5955",],
        ["dae6de","dae6de","8290a5","96a7ba","96a7ba","fff2e9","9c5955","603a30","9c5955","fff2e9","96a7ba","96a7ba","8290a5","dae6de","9c5955",]
    ],
    rigui: [
        ["d1edde","d1edde","d1edde","d1edde","d1edde","d1edde","d1edde","d1edde","d1edde","d1edde","d1edde","fffeef","d1edde","d1edde","d1edde",],
        ["d1edde","d1edde","fffeef","d1edde","d1edde","d1edde","d1edde","d1edde","d1edde","fffeef","fffeef","d1edde","fffeef","f9ebaa","f9ebaa",],
        ["3d4e3b","fffeef","fffeef","fffeef","94b393","94b393","94b393","94b393","d1edde","d1edde","d1edde","f9ebaa","f9ebaa","ffc996","f9ba84",],
        ["3d4e3b","324b23","d1edde","d1edde","cc725a","7a4d4a","7a4d4a","7a4d4a","d1edde","d1edde","f9ebaa","f9ebaa","ffc996","cf907e","cf907e",],
        ["3d4e3b","3d4e3b","d1edde","ad5e4d","cc725a","985544","99493e","985b49","985b49","3d4e3b","f9ebaa","f9ba84","cf907e","cf907e","ce8979",],
        ["3d4e3b","3d4e3b","3d4e3b","cc725a","99493e","99493e","99493e","99493e","985b49","3d4e3b","f9ebaa","f9ba84","ce8979","9b5b52","cf907e",],
        ["293c1c","3d4e3b","3d4e3b","985544","9f8d75","b9a187","b9a187","b9a187","8d4e3d","f9ebaa","ffc996","cf907e","ce8979","c48171","9b5b52",],
        ["32170e","324b23","3d4e3b","324b23","985544","b9a187","9f8d75","b9a187","3d4e3b","3d4e3b","f9ebaa","ffc996","ce8979","c48171","3b4636",],
        ["32170e","243719","32170e","293c1c","8d4e3d","a7937b","887763","a7937b","f9ebaa","f9ba84","cf907e","f9ba84","f9ba84","f9ba84","cf907e",],
        ["b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","f9ebaa","cf907e","ac685b","bf7366","ac685b","ac685b",],
        ["b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","b3ce49","f9ebaa","cf907e","ce8979","ce8979","ce8979","ce8979",],
        ["b3ce49","b3ce49","84a91e","84a91e","84a91e","b3ce49","b3ce49","b3ce49","f9ebaa","cf907e","ce8979","cf907e","cf907e","cf907e","cf907e",],
        ["b3ce49","b3ce49","b3ce49","84a91e","84a91e","84a91e","b3ce49","b3ce49","f9ebaa","cf907e","c48171","cf907e","ffc996","e6b08c","e6b08c",],
        ["b3ce49","b3ce49","84a91e","84a91e","84a91e","84a91e","84a91e","84a91e","f9ebaa","ce8979","c48171","ffc996","e6b08c","cf907e","cf907e",],
        ["b3ce49","b3ce49","b3ce49","84a91e","84a91e","84a91e","84a91e","f9ebaa","f9ebaa","c48171","ffc996","e6b08c","cf907e","cf907e","e6b08c",]
    ],
    THU109: [
        ["ad5abe","ad5abe","b77fd4","ad5abe","ead2f2","c799d4","ead2f2","ad5abe","ead2f2","c799d4",],
        ["dcbfe9","ad5abe","ead2f2","ad5abe","ad5abe","b77fd4","f6e6ff","ad5abe","f6e6ff","b77fd4",],
        ["dcbfe9","ad5abe","ead2f2","ad5abe","f6e6ff","ad5abe","fcf2ff","9b539e","f6e6ff","ad5abe",],
        ["dcbfe9","9b539e","ead2f2","9b539e","f6e6ff","ad5abe","fcf2ff","9b539e","9b539e","ad5abe",],
        ["dcbfe9","ead2f2","ead2f2","f6e6ff","f6e6ff","fcf2ff","fcf2ff","fcf2ff","f6e6ff","ead2f2",],
        ["dcbfe9","c799d4","ead2f2","b77fd4","b77fd4","c799d4","f6e6ff","b77fd4","b77fd4","c799d4",],
        ["ad5abe","b77fd4","ead2f2","ad5abe","f6e6ff","b77fd4","f6e6ff","ad5abe","f6e6ff","b77fd4",],
        ["dcbfe9","ad5abe","ead2f2","ad5abe","ead2f2","b77fd4","ead2f2","9b539e","ad5abe","b77fd4",],
        ["dcbfe9","ad5abe","ead2f2","9b539e","ead2f2","ad5abe","ead2f2","ead2f2","ead2f2","ad5abe",],
        ["dcbfe9","9b539e","dcbfe9","9b539e","9b539e","ad5abe","dcbfe9","9b539e","9b539e","ad5abe",]
    ],
    xueshengka: [
        ["b0bbc1","b0bbc1","b0bbc1","b0bbc1","b0bbc1","b0bbc1","b0bbc1","9fa5b5","9fa5b5","8e90a9",],
        ["d47cb8","d47cb8","d47cb8","c470ab","c470ab","c470ab","ae65be","ae65be","855c96","855c96",],
        ["d47cb8","f4f4f4","d47cb8","f4f4f4","f4f4f4","c470ab","c470ab","ae65be","ae65be","855c96",],
        ["d47cb8","d47cb8","d47cb8","c470ab","c470ab","c470ab","ae65be","ae65be","855c96","855c96",],
        ["eadef2","eadef2","eadef2","eadef2","eadef2","eadef2","f4f4f4","5d5061","5d5061","f4f4f4",],
        ["eadef2","5d5061","eadef2","5d5061","5d5061","eadef2","f4f4f4","fae5d4","f5d9b2","f4f4f4",],
        ["eadef2","eadef2","eadef2","eadef2","eadef2","eadef2","f4f4f4","fae5d4","f5d9b2","f4f4f4",],
        ["eadef2","5d5061","eadef2","5d5061","5d5061","eadef2","f4f4f4","61799f","4e688b","f4f4f4",],
        ["eadef2","eadef2","eadef2","eadef2","eadef2","eadef2","61799f","4e688b","4e688b","4e688b",],
        ["b0bbc1","b0bbc1","9fa5b5","9fa5b5","8e90a9","8e90a9","767b8e","767b8e","767b8e","767b8e",]
    ],
    qingrenpo: [
        ["bfeffd","bfeffd","bfeffd","bfeffd","ffffff","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","ffffff",],
        ["bfeffd","ffffff","bfeffd","ffffff","ffffff","ffffff","bfeffd","bfeffd","ffffff","bfeffd","ffffff","bfeffd","bfeffd","ffffff","ffffff",],
        ["ffffff","ffffff","ffffff","bfeffd","bfeffd","bfeffd","bfeffd","ffffff","ffffff","ffffff","ffffff","ffffff","bfeffd","bfeffd","bfeffd",],
        ["bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd","bfeffd",],
        ["bfeffd","bfeffd","85b07b","85b07b","6d8673","85b07b","bfeffd","bfeffd","bfeffd","5d4f60","5d4f60","bfeffd","5d4f60","5d4f60","bfeffd",],
        ["bfeffd","85b07b","85b07b","85b07b","85b07b","6d8673","85b07b","bfeffd","bfeffd","5d4f60","5d4f60","bfeffd","5d4f60","5d4f60","bfeffd",],
        ["85b07b","85b07b","f2d669","85b07b","6d8673","f2d669","6d8673","85b07b","5d4f60","5d4f60","5d4f60","5d4f60","61799f","61799f","77a0c0",],
        ["85b07b","85b07b","f6c163","f2d669","85b07b","f6c163","f2d669","6d8673","fae2c6","d26a8f","f7d0b3","77a0c0","61799f","61799f","77a0c0",],
        ["85b07b","85b07b","f2d669","f2d669","f2d669","f2d669","f2d669","85b07b","fae2c6","d26a8f","d26a8f","fae2c6","fae2c6","61799f","f7d0b3",],
        ["85b07b","85b07b","ffffff","5d4f60","f2d669","ffffff","5d4f60","85b07b","d26a8f","d26a8f","d26a8f","d26a8f","5d4f60","5d4f60","85b07b",],
        ["85b07b","f2d669","f2d669","f2d669","f2d669","f2d669","f2d669","85b07b","85b07b","fae2c6","fae2c6","6d8673","5d4f60","5d4f60","85b07b",],
        ["85b07b","f2d669","5d4f60","5d4f60","f2d669","f2d669","f6c163","85b07b","6d8673","fae2c6","fae2c6","6d8673","5d4f60","5d4f60","85b07b",],
        ["85b07b","f2d669","f2d669","f2d669","f2d669","f6c163","f6c163","c03842","6d8673","6d8673","6d8673","6d8673","6d8673","6d8673","85b07b",],
        ["85b07b","85b07b","85b07b","c03842","c03842","c03842","c03842","f6c163","f6c163","6d8673","6d8673","6d8673","6d8673","6d8673","6d8673",],
        ["6d8673","6d8673","6d8673","f2d669","f2d669","f6c163","f6c163","f6c163","f6c163","f6c163","6d8673","6d8673","6d8673","6d8673","6d8673",],
    ], 
    yibo: [
        ["b0edff","8ee6ff","b0edff","b0edff","8ee6ff","b0edff","b0edff","b0edff","8ee6ff","b0edff","b0edff","8ee6ff","b0edff","b0edff","b0edff",],
        ["ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","b0edff","b0edff",],
        ["ddbd72","d9ac47","ddbd72","d9ac47","ddbd72","d9ac47","ddbd72","ddbd72","d9ac47","ddbd72","d9ac47","ddbd72","d9ac47","8ee6ff","b0edff",],
        ["ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","8ee6ff","b0edff",],
        ["b88337","b88337","ab7a25","b88337","ab7a25","b88337","ab7a25","b88337","ab7a25","ab7a25","ddbd72","ddbd72","d9ac47","b0edff","b0edff",],
        ["ffe9b6","b88337","ffe9b6","ffe9b6","ffe9b6","b88337","ffe9b6","ffe9b6","ffe9b6","ab7a25","ffe9b6","ffe9b6","ffe9b6","b0edff","8ee6ff",],
        ["d9ac47","b88337","ddbd72","ddbd72","ddbd72","b88337","d9ac47","ddbd72","ddbd72","b88337","ddbd72","ddbd72","d9ac47","8ee6ff","b0edff",],
        ["ffe9b6","b88337","ffe9b6","ffe9b6","ffe9b6","ab7a25","ffe9b6","ffe9b6","ffe9b6","ab7a25","ffe9b6","ffe9b6","ffe9b6","688e42","b0edff",],
        ["ab7a25","ae8547","ae8547","000000","ae8547","ae8547","ae8547","000000","ae8547","8ee6ff","688e42","81b767","81b767","81b767","b0edff",],
        ["ddbd72","ab7a25","ab7a25","ddbd72","ab7a25","ab7a25","ab7a25","ddbd72","ab7a25","8ee6ff","81b767","688e42","81b767","81b767","81b767",],
        ["ffe9b6","ae8547","ae8547","ffe9b6","ae8547","ae8547","ae8547","ffe9b6","ae8547","8ee6ff","8ee6ff","688e42","81b767","688e42","b0edff",],
        ["d9ac47","ab7a25","ab7a25","ddbd72","ab7a25","ab7a25","ab7a25","ddbd72","ab7a25","8ee6ff","b0edff","b0edff","688e42","b0edff","b0edff",],
        ["ffe9b6","ae8547","ae8547","ffe9b6","ae8547","ae8547","ae8547","ffe9b6","ae8547","8ee6ff","8ee6ff","8ee6ff","ab7a25","b0edff","b0edff",],
        ["ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","ffe9b6","b0edff","b0edff",],
        ["81b767","688e42","81b767","688e42","688e42","81b767","688e42","81b767","81b767","688e42","81b767","688e42","81b767","81b767","688e42",],
    ],
    changgeng: [
        ["f9eefe","f9eefe","f9eefe","f9eefe","f9eefe","f9eefe","f9eefe","769fbf","769fbf","769fbf","769fbf","769fbf","769fbf","f9eefe","f9eefe",],
        ["f9eefe","f9eefe","a47fb2","a47fb2","a47fb2","f9eefe","769fbf","d5e6ed","d5e6ed","5dbdb1","d5e6ed","d5e6ed","d5e6ed","769fbf","f9eefe",],
        ["f9eefe","a47fb2","a47fb2","a47fb2","a47fb2","769fbf","d5e6ed","d5e6ed","5dbdb1","d5e6ed","d5e6ed","d5e6ed","d5e6ed","d5e6ed","769fbf",],
        ["a47fb2","a47fb2","a47fb2","ffffff","a47fb2","61799f","61799f","61799f","61799f","61799f","61799f","61799f","61799f","61799f","61799f",],
        ["a47fb2","a47fb2","ffffff","a47fb2","ffffff","61799f","fbede2","63554c","63554c","fbede2","fbede2","63554c","63554c","fbede2","61799f",],
        ["a47fb2","ffffff","a47fb2","a47fb2","a47fb2","61799f","fbede2","ffffff","926d5d","fbede2","fbede2","ffffff","926d5d","fbede2","61799f",],
        ["a47fb2","a47fb2","ffffff","a47fb2","ffffff","61799f","fbede2","ffffff","926d5d","fbede2","fbede2","ffffff","926d5d","fbede2","61799f",],
        ["a47fb2","a47fb2","a47fb2","ffffff","a47fb2","61799f","e7a8b1","e7a8b1","fbede2","61799f","61799f","fbede2","e7a8b1","e7a8b1","61799f",],
        ["a47fb2","a47fb2","a47fb2","a47fb2","a47fb2","769fbf","61799f","61799f","61799f","5dbdb1","5dbdb1","61799f","61799f","61799f","769fbf",],
        ["f9eefe","f9eefe","f9eefe","f9eefe","f9eefe","769fbf","d5e6ed","769fbf","5dbdb1","5dbdb1","5dbdb1","5dbdb1","769fbf","d5e6ed","769fbf",],
        ["f9eefe","f9eefe","f9eefe","f9eefe","769fbf","769fbf","d5e6ed","d5e6ed","769fbf","769fbf","769fbf","769fbf","d5e6ed","d5e6ed","769fbf",],
        ["f9eefe","f9eefe","f9eefe","f9eefe","769fbf","f9edc5","769fbf","d5e6ed","d5e6ed","d5e6ed","d5e6ed","5dbdb1","d5e6ed","d5e6ed","d5e6ed",],
        ["f9eefe","f9eefe","769fbf","769fbf","769fbf","f9edc5","769fbf","769fbf","d5e6ed","d5e6ed","d5e6ed","5dbdb1","d5e6ed","d5e6ed","5dbdb1",],
        ["f9eefe","769fbf","d5e6ed","d5e6ed","f9edc5","f9edc5","f9edc5","f9edc5","769fbf","5dbdb1","d5e6ed","5dbdb1","5dbdb1","5dbdb1","d5e6ed",],
        ["769fbf","d5e6ed","d5e6ed","d5e6ed","f9edc5","f9edc5","f9edc5","f9edc5","769fbf","d5e6ed","d5e6ed","5dbdb1","d5e6ed","d5e6ed","d5e6ed",],
    ],
    zhiyuanzhe: [
        ["ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1",],
        ["ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ef7163","ef7163","ebdcf1","ebdcf1","ebdcf1","ef7163","ef7163","ebdcf1","ebdcf1",],
        ["ebdcf1","ebdcf1","ebdcf1","ebdcf1","ebdcf1","ef7163","ef7163","ef7163","ef7163","ebdcf1","ef7163","ef7163","ef7163","ef7163","ebdcf1",],
        ["f7edf8","ebdcf1","606c6c","606c6c","606c6c","606c6c","606c6c","ef7163","ef7163","ef7163","ef7163","ef7163","ef7163","ef7163","ebdcf1",],
        ["f7edf8","606c6c","606c6c","606c6c","606c6c","606c6c","606c6c","606c6c","ef7163","ef7163","ef7163","ef7163","ef7163","ef7163","ebdcf1",],
        ["f7edf8","606c6c","fae5d0","fae5d0","fae5d0","fae5d0","fae5d0","606c6c","ef7163","ef7163","ef7163","ef7163","ef7163","ebdcf1","ebdcf1",],
        ["f7edf8","606c6c","fae5d0","253648","fae5d0","253648","fae5d0","606c6c","ef7163","ef7163","ef7163","ef7163","ebdcf1","ebdcf1","ebdcf1",],
        ["ffffff","fae5d0","fae5d0","fae5d0","fae5d0","fae5d0","fae5d0","fae5d0","ef7163","ef7163","ef7163","ebdcf1","ebdcf1","ebdcf1","ebdcf1",],
        ["ffffff","fae5d0","aed6f0","d4eaf7","d4eaf7","d4eaf7","d4eaf7","feebcd","f7edf8","ef7163","f7edf8","f7edf8","f7edf8","f7edf8","f7edf8",],
        ["ffffff","ffffff","aed6f0","aed6f0","aed6f0","aed6f0","aed6f0","ffffff","ffffff","f7edf8","f5cba5","f7edf8","f7edf8","f7edf8","f7edf8",],
        ["ffffff","ffffff","ffffff","fae5d0","fae5d0","feebcd","ffffff","ffffff","ffffff","ffffff","f5cba5","ecba97","4f5b5b","4f5b5b","f7edf8",],
        ["ffffff","cc4235","c39ad4","4f5b5b","4f5b5b","4f5b5b","c39ad4","cc4235","cc4235","f5cba5","f5cba5","ecba97","4f5b5b","4f5b5b","f7edf8",],
        ["cc4235","cc4235","cc4235","c39ad4","c39ad4","c39ad4","cc4235","cc4235","cc4235","ecba97","ecba97","ecba97","4f5b5b","4f5b5b","f7edf8",],
        ["4f5b5b","cc4235","cc4235","cc4235","d3b4de","cc4235","a13f00","a13f00","a13f00","212e3e","4f5b5b","4f5b5b","4f5b5b","f7edf8","f7edf8",],
        ["4f5b5b","4f5b5b","cc4235","cc4235","d3b4de","a13f00","a13f00","a13f00","212e3e","4f5b5b","4f5b5b","4f5b5b","f7edf8","f7edf8","f7edf8",],
    ],    
};
monoColorImages = {
    duck: [
        [0,1,1,1,0],
        [0,1,0,1,0],
        [1,1,1,1,0],
        [0,1,1,1,1],
        [0,1,1,0,1],
    ],
    erxiaomen: [
        [1,1,0,0,0,0,0,0,0,0,1,0,1,1,0,],
        [1,1,0,1,1,0,0,1,0,1,1,1,1,1,1,],
        [1,0,1,1,0,1,0,1,0,0,0,1,1,0,1,],
        [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,],
        [0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [0,0,0,1,1,0,1,0,1,0,1,1,0,0,0,],
        [0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,],
        [0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,],
        [0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,],
        [1,0,0,1,1,1,0,0,0,1,1,1,0,0,1,],
        [1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,],
        [1,0,0,1,1,0,0,0,0,0,1,1,0,0,1,],
        [1,0,0,1,1,0,0,0,0,0,1,1,0,0,1,],
        [1,0,0,1,1,0,0,0,0,0,1,1,0,0,1,]
    ],
    dalitang: [
        [1,0,0,0,1,1,1,1,1,1,1,0,0,1,0,],
        [1,1,0,1,0,0,0,1,0,0,0,1,1,1,1,],
        [0,0,0,1,1,1,1,0,1,1,1,1,0,0,0,],
        [1,1,1,1,1,0,0,1,0,0,1,1,1,1,1,],
        [0,1,1,0,0,1,1,1,1,1,0,0,1,1,0,],
        [0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,],
        [1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,],
        [0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,],
        [0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,],
        [0,1,1,1,0,1,0,1,0,1,0,1,1,1,0,],
        [0,1,1,1,0,1,0,1,0,1,0,1,1,1,0,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,]
    ],
    xuetang: [
        [0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,],
        [1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,],
        [0,1,1,0,1,0,1,0,1,0,1,0,1,1,1,],
        [1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,],
        [1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,],
        [1,0,1,1,1,0,0,0,0,0,1,1,1,1,0,],
        [1,0,1,0,0,1,1,1,1,1,0,0,1,1,0,],
        [1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,],
        [1,0,1,0,0,1,0,1,0,1,0,0,1,1,0,],
        [1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,],
        [1,0,1,0,0,1,1,1,1,1,0,0,1,1,0,],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,],
        [0,0,1,0,0,0,1,1,1,0,0,0,1,0,0,]
    ],
    rigui: [
        [0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,],
        [0,0,1,0,0,0,0,0,0,1,1,0,1,0,0,],
        [0,1,1,1,1,1,1,1,0,0,0,0,0,1,1,],
        [1,0,0,0,1,1,1,1,0,0,0,0,1,1,1,],
        [1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,],
        [1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,],
        [1,1,0,1,1,1,1,1,1,0,1,1,1,1,0,],
        [1,1,0,0,1,1,0,1,1,1,0,1,1,1,1,],
        [1,1,1,0,1,1,0,1,0,1,1,0,0,1,1,],
        [1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,],
        [0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,],
        [0,0,1,1,1,0,0,0,0,1,1,1,1,1,1,],
        [0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,],
        [0,0,1,1,1,1,1,1,0,1,1,0,1,1,1,],
        [0,0,0,1,1,1,1,1,0,1,0,1,1,1,1,]
    ],
    THU109: [
        [1,1,1,1,0,1,0,1,0,1,],
        [0,1,0,1,1,1,0,1,0,1,],
        [0,1,0,1,0,1,0,1,0,1,],
        [0,1,0,1,0,1,0,1,1,1,],
        [0,0,0,0,0,0,0,0,0,0,],
        [0,1,0,1,1,1,0,1,1,1,],
        [1,1,0,1,0,1,0,1,0,1,],
        [0,1,0,1,0,1,0,1,1,1,],
        [0,1,0,1,0,1,0,0,0,1,],
        [0,1,0,1,1,1,0,1,1,1,]
    ],
    xueshengka: [
        [1,1,1,1,1,1,1,1,1,1,],
        [0,0,0,0,0,0,0,0,0,0,],
        [0,1,0,1,1,0,0,0,0,0,],
        [0,0,0,0,0,0,0,0,0,0,],
        [1,1,1,1,1,1,0,1,1,0,],
        [1,0,1,0,0,1,0,0,0,0,],
        [1,1,1,1,1,1,0,0,0,0,],
        [1,0,1,0,0,1,0,1,1,0,],
        [1,1,1,1,1,1,1,1,1,1,],
        [1,1,1,1,1,1,1,1,1,1,],
    ],
    qingrenpo: [
        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,],
        [0,1,0,1,1,1,0,0,1,0,1,0,0,1,1,],
        [1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
        [0,0,1,1,1,1,0,0,0,1,1,0,1,1,0,],
        [0,1,0,0,0,0,1,0,0,1,1,0,1,1,0,],
        [1,0,1,0,0,1,0,1,1,1,1,1,1,1,1,],
        [0,0,1,1,0,1,1,0,0,1,0,1,1,1,1,],
        [0,0,1,1,1,1,1,0,0,1,1,0,0,1,0,],
        [0,0,1,0,1,1,0,0,1,1,1,1,1,1,1,],
        [0,1,1,1,1,1,1,0,0,1,1,0,1,1,0,],
        [0,1,0,0,1,1,1,0,0,1,1,0,1,1,0,],
        [0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,],
        [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,],
        [0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,],
    ],    
    yibo: [
        [1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,],
        [1,1,1,0,1,1,1,0,1,0,1,1,1,1,0,],
        [1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,],
        [0,1,1,0,1,1,1,0,1,0,0,1,1,1,0,],
        [1,1,1,1,1,1,1,1,1,0,0,0,1,0,0,],
        [0,1,1,0,1,1,1,0,1,0,0,0,1,0,0,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,],
    ],
    changgeng: [
        [1,1,0,0,0,1,0,1,1,1,1,1,1,0,0,],
        [1,0,1,1,1,0,1,0,0,1,0,0,0,1,0,],
        [0,1,1,1,1,1,0,0,1,0,0,0,0,0,1,],
        [1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,],
        [1,1,0,1,0,1,0,1,1,0,0,1,1,0,1,],
        [1,0,1,1,1,1,0,0,1,0,0,0,1,0,1,],
        [1,1,0,1,0,1,0,0,1,0,0,0,1,0,1,],
        [1,1,1,0,1,1,1,1,0,1,1,0,1,1,1,],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,],
        [0,0,0,0,0,1,0,1,1,1,1,1,1,0,1,],
        [1,1,1,0,1,1,0,0,1,1,1,1,0,0,1,],
        [1,1,0,0,1,0,1,0,0,0,0,1,0,0,1,],
        [1,0,1,1,1,0,1,1,0,0,0,1,0,0,1,],
        [0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,],
        [1,0,0,0,0,0,0,0,1,0,0,1,0,0,1,],
    ],
    zhiyuanzhe: [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,],
        [0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,],
        [0,0,0,0,0,1,1,1,1,0,1,1,1,1,0,],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,],
        [0,1,0,0,0,0,0,1,1,1,1,1,1,0,0,],
        [0,1,0,1,0,1,0,1,1,1,1,1,0,0,0,],
        [0,1,0,0,0,0,0,1,1,1,1,0,0,0,0,],
        [0,1,1,1,1,1,1,1,0,1,1,1,0,0,0,],
        [0,0,1,1,1,1,1,0,0,1,0,1,1,0,0,],
        [0,0,0,1,0,1,0,0,1,1,0,0,1,1,0,],
        [0,1,1,1,1,1,1,1,1,0,0,0,1,1,0,],
        [1,1,1,0,0,0,1,1,1,0,0,0,1,1,0,],
        [0,1,1,1,0,1,1,1,1,1,1,1,1,0,0,],
        [0,0,1,1,0,1,1,1,1,1,1,1,0,0,0,],
    ],
};

//const boxWidth = 50;
const gameAreaX = 140;
const gameAreaY = 200;
const gameAreaWidth = 750;
const canvasWidth = 900;
const buttonMiddleX = 515;
const gapAboveButtons = 70;
const buttonRadius = 75;
const helpButtonRadius = 60;
const hpX = 50;
const gapAboveHp = 100;
const gapBetweenHp = 10;
const hpWidth=80;
const maxHp = 3;
const tryAgainX = gameAreaX + gameAreaWidth / 2;
const tryAgainY = 650;
const tryAgainWidth = 400;
const tryAgainHeight = 200;
var invincible = false;
var finished_levels = 0;
var background_color = "#e8e5dc";

dist2 = function(x1, y1, x2, y2){
    return (x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2);
}
function box(fatherCanvas, row, col, correctAnswer = "empty", status = "empty"){

    this.fatherCanvas = fatherCanvas;
    this.ctx = fatherCanvas.ctx;
    this.row = row;
    this.col = col;
    this.boxWidth = this.fatherCanvas.boxWidth;
    this.x = gameAreaX + this.boxWidth * (col - 1);
    this.y = gameAreaY + this.boxWidth * (row - 1);
    this.status = status; //三种状态: empty 空白, filled 涂黑, cross 打叉
    this.correctAnswer = correctAnswer; // empty 或 filled
    this.lock = false;
    this.color = background_color;

    this.draw = function(){
        this.ctx.fillStyle = this.status == "filled" ? "dimGray" : this.color; //涂色
        this.ctx.fillRect(this.x, this.y, this.boxWidth, this.boxWidth);
        this.ctx.strokeStyle = "gray"; //边框
        this.ctx.lineWidth = 1;
        this.ctx.strokeRect(this.x, this.y, this.boxWidth, this.boxWidth);
        if(this.status == "cross"){ //画个叉
            this.ctx.lineWidth = 5;
            this.ctx.strokeStyle = "gray";
            this.ctx.beginPath();
            this.ctx.moveTo(this.x + 5, this.y + 5);
            this.ctx.lineTo(this.x + this.boxWidth - 5, this.y + this.boxWidth - 5);
            this.ctx.moveTo(this.x + this.boxWidth - 5, this.y + 5);
            this.ctx.lineTo(this.x + 5, this.y + this.boxWidth - 5);
            this.ctx.stroke();
        }
        this.fatherCanvas.drawBoldBorder();
    }

    this.draw();

    this.changeColor = function(color){
        this.color = color;
        this.draw();
    }

    this.paint = function(color){
        this.ctx.fillStyle = "#" + color; //涂色
        this.ctx.fillRect(this.x, this.y, this.boxWidth, this.boxWidth);
    }

    this.wrong = function(){
        this.fatherCanvas.hp.dropHp();
        this.ctx.fillStyle = "#FF7373"; //涂色
        this.ctx.fillRect(this.x + 1, this.y + 1, this.boxWidth - 2, this.boxWidth - 2);
        this.fatherCanvas.drawBoldBorder();
        this.status = this.correctAnswer;
        setTimeout(this.draw.bind(this), 500);
    }

    this.reset = function(){
        this.status = "empty";
        this.draw();
    }

    this.handleClick = function(){
        if(this.lock) return;
        this.color=background_color;
        var lastStatus = this.status;
        if(this.status != "empty" && this.fatherCanvas.penMode != "empty") return;
        if(this.fatherCanvas.penMode != this.correctAnswer){
            console.log("nope!");
            this.wrong();
        }
        else{
            this.status = this.fatherCanvas.penMode;
            this.draw();
        }
        return lastStatus == "empty" && this.correctAnswer == "filled";
    }
}
function hp(fatherCanvas){

    this.fatherCanvas = fatherCanvas;
    this.ctx = fatherCanvas.ctx;
    this.hpValue = maxHp;
    this.x = hpX;
    this.y = gameAreaY + gameAreaWidth + gapAboveHp;
    this.heartImg = new Image();
    this.heartImg.src = "images/heart.png";
    this.emptyHeartImg = new Image();
    this.emptyHeartImg.src = "images/emptyHeart.png";

    this.draw = function(){
        for(var i = 0; i < maxHp; i++)
            this.ctx.drawImage(i < this.hpValue ? this.heartImg : this.emptyHeartImg, this.x + i * (hpWidth + gapBetweenHp), this.y, hpWidth, hpWidth);
    }

    this.dropHp = function(){
        if(invincible) return;
        this.hpValue--;
        console.log("HP--! Now hp = " + this.hpValue.toString());
        this.draw();
    }

    this.reset = function(){
        this.hpValue = maxHp;
        this.draw();
    }

    this.draw();
}
function modeButton(fatherCanvas, mode){

    this.fatherCanvas = fatherCanvas;
    this.ctx = fatherCanvas.ctx;
    this.mode = mode;
    this.cx = mode == "filled" ? buttonMiddleX + buttonRadius: buttonMiddleX - buttonRadius;
    this.cy = gameAreaY + gameAreaWidth + gapAboveButtons + buttonRadius;
    this.status = mode == "filled";
    this.lock = false;
    this.color = "lightGray";

    this.draw = function(){
        //外面画圈白
        if(this.status == false){
            this.ctx.fillStyle = background_color;
            this.ctx.beginPath();
            this.ctx.arc(this.cx, this.cy, buttonRadius, 0, 2*Math.PI);
            this.ctx.fill();
        }
        //里面涂上灰
        this.ctx.fillStyle = this.status ? "gray": this.color;
        this.ctx.beginPath();
        this.ctx.arc(this.cx, this.cy, buttonRadius - (this.status ? 0 : 10) - 1, 0, 2*Math.PI);
        this.ctx.fill();
        //中间画个方
        if(this.mode == "filled"){
            this.ctx.fillStyle = this.status ? "lightGray": "gray";
            rectRadius = 30;
            this.ctx.fillRect(this.cx - rectRadius, this.cy - rectRadius, 2 * rectRadius, 2 * rectRadius);
        }
        //或者打个叉
        else{
            crossRadius = 30;
            this.ctx.strokeStyle = this.status ? "lightGray": "gray";
            this.ctx.lineWidth = 10;
            this.ctx.beginPath();
            this.ctx.moveTo(this.cx - crossRadius, this.cy - crossRadius);
            this.ctx.lineTo(this.cx + crossRadius, this.cy + crossRadius);
            this.ctx.moveTo(this.cx - crossRadius, this.cy + crossRadius);
            this.ctx.lineTo(this.cx + crossRadius, this.cy - crossRadius);
            this.ctx.stroke();
        }
    }
    
    this.switchStatus = function(newStatus){
        if(this.lock) return;
        this.status = newStatus;
        this.draw();
    }

    this.changeColor = function(color){
        this.color = color;
        this.draw();
    }

    this.draw();
}
function helpButton(fatherCanvas){

    this.fatherCanvas = fatherCanvas;
    this.ctx = fatherCanvas.ctx;
    this.cx = canvasWidth - helpButtonRadius - 20;
    this.cy = gameAreaY + gameAreaWidth + gapAboveButtons + buttonRadius;

    this.draw = function(){
        this.ctx.fillStyle = "#eee";
        this.ctx.beginPath();
        this.ctx.arc(this.cx, this.cy, helpButtonRadius - (this.status ? 0 : 10) - 1, 0, 2*Math.PI);
        this.ctx.fill();
        this.ctx.font = "bolder 80px Arial";
        this.ctx.fillStyle = "#aaa"; // 字体颜色
        this.ctx.textAlign = "center"; // 设置水平对齐方式
        this.ctx.textBaseline = "middle"; // 设置垂直对齐方式
        this.ctx.fillText("?", this.cx, this.cy + 5);
    }
    
    this.draw();
}
function rowNumberBar(fatherCanvas, row, numbers){

    this.fatherCanvas = fatherCanvas;
    this.ctx = fatherCanvas.ctx;
    this.row = row;
    this.numbers = numbers;
    if(this.numbers.length == 1) this.numbers = [0, 0];
    this.boxWidth = this.fatherCanvas.boxWidth;
    this.y = gameAreaY + row * this.boxWidth - this.boxWidth/2; //中线纵坐标
    this.status = true; //true: 还没填完; false: 填完了
    this.color = "lightGray";
    
    this.draw = function(){
        if(this.numbers[1] == 0) this.status = false;
        this.ctx.fillStyle = this.status ? this.color: "#eee"; // 背景颜色
        this.ctx.fillRect(0, this.y - (this.boxWidth - 10)/2, 130, this.boxWidth-10); // 画背景
        var fontSize = this.boxWidth == 150? 50: (this.boxWidth == 75 ? 33 : 22);
        this.ctx.font = "bolder " + fontSize.toString() + "px Arial";
        this.ctx.fillStyle = this.status ? "dimGray" : "#aaa"; // 字体颜色
        this.ctx.textAlign = "right"; // 设置水平对齐方式
        this.ctx.textBaseline = "middle"; // 设置垂直对齐方式
        str = "";// 生成字符串
        for(var i = 1, len = this.numbers.length; i < len; i++)
            str += " " + this.numbers[i].toString();
        this.ctx.fillText(str, gameAreaX - 15, this.y);
    }
    
    this.mute = function(){
        this.status = false;
        this.draw();
    }

    this.reset = function(){
        this.status = true;
        this.draw();
    }

    this.draw();
}
function columnNumberBar(fatherCanvas, column, numbers){

    this.fatherCanvas = fatherCanvas;
    this.ctx = fatherCanvas.ctx;
    this.column = column;
    this.numbers = numbers;
    if(this.numbers.length == 1) this.numbers = [0, 0];
    this.boxWidth = this.fatherCanvas.boxWidth;
    this.x = gameAreaX + column * this.boxWidth - this.boxWidth/2; //中线横坐标
    this.status = true; //true: 还没填完; false: 填完了
    this.color = "lightGray";
    
    this.draw = function(){
        if(this.numbers[1] == 0) this.status = false;
        this.ctx.fillStyle = this.status ? this.color: "#eee"; // 一列数字的背景
        this.ctx.fillRect(this.x - (this.boxWidth - 10)/2, 0, this.boxWidth - 10, 190);
        var fontSize = this.boxWidth == 150? 50: (this.boxWidth == 75 ? 33 : 22);
        this.ctx.font = "bolder " + fontSize.toString() + "px Arial";
        this.ctx.fillStyle = this.status ? "dimGray" : "#aaa";
        this.ctx.textAlign = "left";
        this.ctx.textBaseline = "bottom";
        // 绘制文字（参数：要写的字，x坐标，y坐标）
        for(var i = 1, len = this.numbers.length; i < len; i++){
            this.ctx.fillText(this.numbers[len - i], this.x - this.ctx.measureText(this.numbers[len - i].toString()).width/2, gameAreaY - 20 - (i - 1) * fontSize);
        }
    }

    this.mute = function(){
        this.status = false;
        this.draw();
    }

    this.reset = function(){
        this.status = true;
        this.draw();
    }

    this.changeColor = function(color){
        this.color = color;
        this.draw();
    }

    this.draw();
}
function gameCanvas(num, gameWidth = 15, monoColorImage, multiColorImage, title){

    this.num = num;
    this.penMode = "filled"; // "cross" or "filled"
    this.canvasId = "canvas" + num;
    this.cvs = document.getElementById(this.canvasId);
    this.ctx = this.cvs.getContext("2d"); 
    this.boxWidth = gameAreaWidth / gameWidth;
    this.monoColorImage = monoColorImage;
    this.multiColorImage = multiColorImage;
    this.rowToFill = new Array();
    this.columnToFill = new Array();
    this.rowSegments = new Array();
    this.columnSegments = new Array();
    this.toFill = 0;
    this.lock = false;

    this.countImage = function(){
        this.rowToFill = new Array();
        this.columnToFill = new Array();
        this.rowSegments = new Array();
        this.columnSegments = new Array();
        this.toFill = 0;
        for(var i = 1; i <= gameWidth; i++)
            this.rowToFill[i] = this.columnToFill[i] = 0;
        for(var i = 1; i <= gameWidth; i++){
            for(var j = 1; j <= gameWidth; j++){
                this.rowToFill[i] += this.monoColorImage[i-1][j-1];
                this.columnToFill[j] += this.monoColorImage[i-1][j-1];
            }
        }
        for(var i = 1; i <= gameWidth; i++){
            if(this.rowToFill[i]) this.toFill++;
            if(this.columnToFill[i]) this.toFill++;
        }
        for(var i = 1; i <= gameWidth; i++){
            this.rowSegments[i] = [0];
            for(var j = 1; j <= gameWidth; j++){
                if(this.monoColorImage[i-1][j-1]){
                    if(j == 1 || this.monoColorImage[i-1][j-2] == 0)
                        this.rowSegments[i][this.rowSegments[i].length] = 1;
                    else
                        this.rowSegments[i][this.rowSegments[i].length - 1]++;
                }
            }
        }
        for(var j = 1; j <= gameWidth; j++){
            this.columnSegments[j] = [0];
            for(var i = 1; i <= gameWidth; i++){
                if(this.monoColorImage[i-1][j-1]){
                    if(i == 1 || this.monoColorImage[i-2][j-1] == 0)
                        this.columnSegments[j][this.columnSegments[j].length] = 1;
                    else
                        this.columnSegments[j][this.columnSegments[j].length - 1]++;
                }
            }
        }
    }
    this.countImage();

    this.drawBoldBorder = function(){
        this.ctx.lineWidth = 3;
        this.ctx.strokeStyle = "Black";
        this.ctx.strokeRect(gameAreaX, gameAreaY, gameAreaWidth, gameAreaWidth);
        this.ctx.beginPath();
        this.ctx.moveTo(gameAreaX, gameAreaY + this.boxWidth * 5);
        this.ctx.lineTo(gameAreaX + gameAreaWidth, gameAreaY + this.boxWidth * 5);
        this.ctx.moveTo(gameAreaX, gameAreaY + this.boxWidth * 10);
        this.ctx.lineTo(gameAreaX + gameAreaWidth, gameAreaY + this.boxWidth * 10);
        this.ctx.moveTo(gameAreaX + this.boxWidth * 5, gameAreaY);
        this.ctx.lineTo(gameAreaX + this.boxWidth * 5, gameAreaY + gameAreaWidth);
        this.ctx.moveTo(gameAreaX + this.boxWidth * 10, gameAreaY);
        this.ctx.lineTo(gameAreaX + this.boxWidth * 10, gameAreaY + gameAreaWidth);
        this.ctx.stroke();
    }
    
    //定义所有方块组成的二维数组
    this.boxArray = new Array();
    for(var i = 1; i <= gameWidth; i++){
        this.boxArray[i] = new Array();
        for(var j = 1; j <= gameWidth; j++){
            correctInt = this.monoColorImage ? this.monoColorImage[i-1][j-1]: 0;
            this.boxArray[i][j] = new box(this, i, j, correctAnswer = correctInt ? "filled" : "cross");
        }
    }
    
    this.buttonArray = [new modeButton(this, "cross"), new modeButton(this, "filled"), new helpButton(this)];

    this.rowNumberBarArray = new Array();
    for(var i = 1; i <= gameWidth; i++){
        this.rowNumberBarArray[i] = new rowNumberBar(this, i, this.rowSegments[i]);
    }
    this.columnNumberBarArray = new Array();
    for(var i = 1; i <= gameWidth; i++){
        this.columnNumberBarArray[i] = new columnNumberBar(this, i, this.columnSegments[i]);
    }
    this.hp = new hp(this);

    var lastPaintedLine = 0;

    this.paintDiag = function(){
        if(lastPaintedLine >= 2 * gameWidth - 1) return;
        lastPaintedLine++;
        var i = lastPaintedLine;
        if(i <= gameWidth){
            for(var j = 1; j <= i; j++){
                this.boxArray[i-j+1][j].paint(this.multiColorImage[i-j][j-1]);
            }
        }
        else{
            i = i - gameWidth + 1;
            for(var j = i; j <= gameWidth; j++){
                this.boxArray[i-j+gameWidth][j].paint(this.multiColorImage[i-j+gameWidth-1][j-1]);
            }
        }
    }

    this.showTitle = function(){
        this.ctx.fillStyle = background_color;
        this.ctx.fillRect(0, gameAreaY + gameAreaWidth + 10, canvasWidth, 300);
        this.ctx.fillStyle = "dimGray";
        this.ctx.font = "bold 100px Hei";
        this.ctx.textAlign = "center";
        this.ctx.textBaseline = "top";
        this.ctx.fillText(title, canvasWidth / 2, gameAreaY + gameAreaWidth + 70)
    }
    this.paint = function(){
        var startTime = 600;
        for(var i = 1; i <= 2 * gameWidth - 1; i++){
            setTimeout(this.paintDiag.bind(this), startTime + 20 * i);
        }
        setTimeout(this.showTitle.bind(this), startTime + 40 * gameWidth);
        this.ctx.font = "50px";
        
    }

    this.gameOver = function(){
        console.log("Game Over!");
        this.ctx.fillStyle = "#6668";
        this.ctx.fillRect(gameAreaX, gameAreaY, gameAreaWidth, gameAreaWidth);

        this.ctx.fillStyle = "#f3f3f3";
        this.ctx.fillRect(tryAgainX - tryAgainWidth/2, tryAgainY - tryAgainHeight/2, tryAgainWidth, tryAgainHeight);

        this.ctx.fillStyle = "#f3f3f3";
        this.ctx.font = "bolder 100px Arial";
        this.ctx.textAlign = "center"; // 设置水平对齐方式
        this.ctx.textBaseline = "bottom"; // 设置垂直对齐方式
        this.ctx.fillText("Game Over", tryAgainX, tryAgainY - tryAgainHeight/2 - 50);
        
        this.ctx.fillStyle = "dimGray";
        this.ctx.font = "bolder 70px Arial";
        this.ctx.textAlign = "center"; // 设置水平对齐方式
        this.ctx.textBaseline = "middle"; // 设置垂直对齐方式
        this.ctx.fillText("Try Again!", tryAgainX, tryAgainY);

        this.lock = false;
    }

    this.tryAgain = function(){
        console.log("Try Again!");
        this.countImage();
        for(var i = 1; i <= gameWidth; i++)
            for(var j = 1; j <= gameWidth; j++)
                this.boxArray[i][j].reset();
        for(var i = 1; i <= gameWidth; i++){
            this.rowNumberBarArray[i].reset();
            this.columnNumberBarArray[i].reset();
        }
        this.hp.reset();
    }

    this.finish = function(){
        this.lock = true;
        this.paint();
        description = document.getElementById("description" + num.toString());
        if(description) setTimeout("description.style.display = 'block'", 1200);
        finished_levels++;
        document.title="我在“校庆挑战”中拼出了" + finished_levels.toString() + "幅清华故事！"
        if(num==0) this.tutorial7();
        if(finished_levels == 11) document.getElementById("allClear").style.display = "block";
    }

    this.visitedTutorial2 = false;
    this.visitedTutorial3 = false;
    this.visitedTutorial4 = false;
    this.visitedTutorial5 = false;
    this.visitedTutorial6 = false;
    this.handleClick = function(x, y){
        if(this.lock) return;
        if(x >= gameAreaX && x < gameAreaX + gameAreaWidth && y >= gameAreaY && y < gameAreaY + gameAreaWidth){
            if(this.hp.hpValue <= 0){
                if(Math.abs(x - tryAgainX) < tryAgainWidth/2 && Math.abs(y - tryAgainY) < tryAgainHeight/2){
                    this.tryAgain()
                }
                return;
            }
            row = Math.floor((y - gameAreaY) / this.boxWidth) + 1; 
            column = Math.floor((x - gameAreaX) / this.boxWidth) + 1;
            var res = this.boxArray[row][column].handleClick();
            if(res){
                this.rowToFill[row] -= res;
                this.columnToFill[column] -= res;
                if(this.rowToFill[row] == 0){
                    this.rowNumberBarArray[row].mute();
                    this.toFill--;
                }
                if(this.columnToFill[column] == 0){
                    this.columnNumberBarArray[column].mute();
                    this.toFill--;
                }
                if(this.toFill == 0) this.finish();
                console.log(this.toFill);
                console.log(this.rowToFill);
                console.log(this.columnToFill);
                if(num==0){
                    if(this.columnToFill[2] == 0 && !this.visitedTutorial2){
                        this.visitedTutorial2 = true;
                        this.tutorial2();
                    }
                    if(this.columnToFill[3] == 0 && !this.visitedTutorial3){
                        this.visitedTutorial3 = true;
                        this.tutorial3();
                    }
                    if(this.rowToFill[5] == 0 && !this.visitedTutorial6){
                        this.visitedTutorial6 = true;
                        this.tutorial6();
                    }
                }
            }
            if(num==0 && this.boxArray[5][1].status == "cross" && this.boxArray[5][4].status == "cross" && !this.visitedTutorial5){
                this.visitedTutorial5 = true;
                this.tutorial5();
            }
            if(this.hp.hpValue <= 0){
                this.lock = true;
                setTimeout(this.gameOver.bind(this), 600);
            }
        }
        else{
            for(var i = 0; i <= 1; i++){
                if(dist2(x, y, this.buttonArray[i].cx, this.buttonArray[i].cy) <= buttonRadius * buttonRadius){
                    if(this.buttonArray[i].lock || this.buttonArray[1-i].lock) return;
                    this.buttonArray[i].switchStatus(true);
                    this.buttonArray[1 - i].switchStatus(false);
                    this.penMode = i ? "filled" : "cross";
                    if(!this.visitedTutorial4){
                        this.visitedTutorial4 = true;
                        this.tutorial4();
                    }
                }
            }
            if(dist2(x, y, this.buttonArray[2].cx, this.buttonArray[2].cy) <= helpButtonRadius * helpButtonRadius){
                document.getElementById('helpDiv').style.display = "";
            }
        }
    }
}

canvasNumber = 10;
canvasContent = [
    [5, 'duck', '小黄鸭'], 
    [10, 'THU109', '清华109周年校庆'],
    [10, 'xueshengka', '学生卡'],
    [15, 'erxiaomen', '二校门'],
    [15, 'dalitang', '大礼堂'],
    [15, 'rigui', '日晷'],
    [15, 'xuetang', '学堂'],
    [15, 'qingrenpo', '情人坡'],
    [15, 'yibo', '艺术博物馆'],
    [15, 'changgeng', '清华长庚医务工作者'],
    [15, 'zhiyuanzhe', '清华战疫志愿者'],
];
canvasArray = [];

var ready = false;
window.onload = function(){
    document.body.style.overflow = "auto";
    this.document.getElementById("loading").style.display = "none";
    for(var i = 0; i <= canvasNumber; i++){
        canvasArray[i] = new gameCanvas(i, canvasContent[i][0], monoColorImages[canvasContent[i][1]], multiColorImages[canvasContent[i][1]], canvasContent[i][2]);
    }
    for(var i = 1; i <= 5; i++)
        for(var j = 1; j <= 5; j++)
            canvasArray[0].boxArray[i][j].lock = true;
    canvasArray[0].buttonArray[0].lock = true;
    canvasArray[0].buttonArray[1].lock = true;
    canvasArray[0].tutorial1 = function(){
        this.columnNumberBarArray[2].changeColor("#bbd877");
        this.ctx.fillStyle = background_color;
        div = document.getElementById("tutorialTextDiv");
        text = document.getElementById("tutorialText");
        div.style.background = "#eee";
        text.innerHTML = '这个数字“5”代表这一列要涂五个格子<br/>点击它们，把这一列填满！'
        for(var i = 1; i <= 5; i++){
            this.boxArray[i][2].lock = false;
            this.boxArray[i][2].changeColor("#d1e6a1");
        }   
    }
    canvasArray[0].tutorial2 = function(){
        this.columnNumberBarArray[3].changeColor("#bbd877");
        text = document.getElementById("tutorialText");
        text.innerHTML = '当有多个数字时，<br/>对应的两段黑色格子中间至少空一格';
        for(var i = 1; i <= 5; i++){
            if(i == 2) continue;
            this.boxArray[i][3].lock = false;
            this.boxArray[i][3].changeColor("#d1e6a1");
        } 
    }
    canvasArray[0].tutorial3 = function(){
        console.log("tutorial 3!");
        text = document.getElementById("tutorialText");
        text.innerHTML = '行与列规则相同。<br/>当你知道某个格子不可能被涂色，<br/>可以用“X”标记它。点击“X”按钮！';
        this.buttonArray[0].lock = this.buttonArray[1].lock = false;
        this.buttonArray[0].changeColor("#bbd877");
    }
    canvasArray[0].tutorial4 = function(){
        text = document.getElementById("tutorialText");
        text.innerHTML = '用“X”标记不可能的格子！';
        this.buttonArray[0].changeColor("lightGray");
        this.boxArray[5][1].lock = false;
        this.boxArray[5][1].changeColor("#d1e6a1");
        this.boxArray[5][4].lock = false;
        this.boxArray[5][4].changeColor("#d1e6a1");
    }
    canvasArray[0].tutorial5 = function(){
        text = document.getElementById("tutorialText");
        text.innerHTML = '点击“X”按钮旁边的涂色按钮，<br/>切换回涂色模式，完成第五行！';
        this.boxArray[5][5].lock = false;
        this.boxArray[5][5].changeColor("#d1e6a1");
    }
    canvasArray[0].tutorial6 = function(){
        text = document.getElementById("tutorialText");
        text.innerHTML = '使用这两种工具，尝试完成整张图片！<br/>如果你忘记了规则，点击右下角的问号按钮';
        for(var i = 1; i <= 5; i++){
            for(var j = 1; j <= 5; j++){
                this.boxArray[i][j].lock = false;
                this.boxArray[i][j].changeColor(background_color);
            }
        }
        this.columnNumberBarArray[2].changeColor("lightGray");
        this.columnNumberBarArray[3].changeColor("lightGray");
    }
    canvasArray[0].tutorial7 = function(){
        text = document.getElementById("tutorialText");
        text.innerHTML = '恭喜你完成了第一张图片！<br/>快去挑战接下来的关卡吧！';
    }
    ready=true;
}

function startTutorial(){
    if(ready){
        canvasArray[0].tutorial1();
        ready = false;
    }
}

function finishAll(){
    for(var i = 0; i <= canvasNumber; i++){
        setTimeout(canvasArray[i].finish.bind(canvasArray[i]), i * 1000);
    }
}

var cheatTime = 0;
function cheatForTest(){
    cheatTime++;
    if(cheatTime == 3) finishAll();
}

function getEventPosition(e){
    var x, y;
    if(e.layerX || e.layerX == 0) {
        x = e.layerX;
        y = e.layerY;
    } 
    else if(e.offsetX || e.offsetX == 0) { // Opera
        x = e.offsetX;
        y = e.offsetY;
    }
    return {x: x, y: y};
}

function hideHelp(){
    document.getElementById('helpDiv').style.display = "none";
}
function showOrHideSubscribe(){
    var obj = document.getElementById('subscribe');
    obj.style.display = obj.style.display == 'block' ? 'none':'block';
}

function handleClick(e){
    p = getEventPosition(e);
    console.log("You clicked (" + p.x + ", " + p.y + "), target is " + e.target.id);
    if(e.target.tagName == "CANVAS"){
        canvasNum = parseInt(e.target.id.substring(6, e.target.id.length));
        //canvasArray[canvasNum].handleClick(p.x, p.y);
        var canvasObj = canvasArray[canvasNum];
        var canvasWidth = canvasObj.cvs.width;
        var screenWidth = canvasObj.cvs.clientWidth;
        var ratio = canvasWidth / screenWidth;
        console.log("canvas Cor = ", p.x * ratio, p.y * ratio);
        canvasObj.handleClick(p.x * ratio, p.y * ratio);
    }
}

addEventListener('click', handleClick, false);
var touchStartPosition = {x: -1, y: -1};
addEventListener('touchstart', function(e){
    touchStartPosition = getEventPosition(e);
}, false);
addEventListener('touchend', function(e){
    var touchEndPosition = getEventPosition(e);
    if(dist2(touchStartPosition.x, touchStartPosition.y, touchEndPosition.x, touchEndPosition.y) <= 20*20)
        handleClick(e);
}, false);

